<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Fintech Automation - Dashboard Power BI</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #0a2540;
            --secondary: #00a1e0;
            --accent: #f5b700;
            --light: #f5f7fa;
            --dark: #1c1f26;
        }

        body { font-family: "Inter", sans-serif; background: var(--light); color: var(--dark); }
        .navbar { background: var(--primary); }
        .navbar a { color: white !important; }
        .kpi-card { background: white; border-radius: 12px; padding: 20px; text-align:center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .kpi-card h3 { margin:0; color: var(--primary); font-size: 1.5rem; }
        .kpi-card p { margin:0; color: #555; }

        .chart-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2.section-title { color: var(--primary); margin-bottom: 20px; }

        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align:center; }
        th { background: var(--secondary); color:white; }
    </style>
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">Fintech Automation</a>
        </div>
    </nav>

    <div class="container" style="padding-top: 80px;">

        <!-- KPI Cards -->
        <div class="row">
            <div class="col-md-2">
                <div class="kpi-card">
                    <h3>{{ total_income }}</h3>
                    <p>Chiffre d'affaires YTD</p>
                    <small class="text-success">+12%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <h3>38%</h3>
                    <p>Marge Brute</p>
                    <small class="text-success">+2 pts</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <h3>24 500 000</h3>
                    <p>EBITDA</p>
                    <small class="text-danger">-4%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <h3>18 200 000</h3>
                    <p>Résultat Net</p>
                    <small class="text-success">+6%</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="kpi-card">
                    <h3>{{ total_balance }}</h3>
                    <p>Cash disponible</p>
                    <small class="text-success">+1.2M</small>
                </div>
            </div>
        </div>

        <!-- LINE CHART -->
        <div class="chart-card">
            <h2 class="section-title">Évolution des revenus / charges / cash-flow</h2>
            <canvas id="lineChart"></canvas>
        </div>

        <!-- BAR CHART -->
        <div class="chart-card">
            <h2 class="section-title">Charges principales par catégorie</h2>
            <canvas id="barChart"></canvas>
        </div>

        <!-- DONUT CHART -->
        <div class="chart-card">
            <h2 class="section-title">Répartition des comptes / clients</h2>
            <canvas id="donutChart"></canvas>
        </div>

        <!-- TABLEAU RÉEL VS BUDGET -->
        <div class="chart-card">
            <h2 class="section-title">Réel vs Budget vs N-1</h2>
            <table>
                <thead>
                    <tr>
                        <th>Poste</th>
                        <th>Réel</th>
                        <th>Budget</th>
                        <th>N-1</th>
                        <th>Variance %</th>
                        <th>Variance Absolue</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ventes</td>
                        <td>120 000</td>
                        <td>115 000</td>
                        <td>110 000</td>
                        <td class="text-success">+4.3%</td>
                        <td class="text-success">+5 000</td>
                    </tr>
                    <tr>
                        <td>Charges</td>
                        <td>60 000</td>
                        <td>65 000</td>
                        <td>58 000</td>
                        <td class="text-danger">-7.7%</td>
                        <td class="text-danger">-5 000</td>
                    </tr>
                    <tr>
                        <td>EBITDA</td>
                        <td>40 000</td>
                        <td>35 000</td>
                        <td>38 000</td>
                        <td class="text-success">+14.3%</td>
                        <td class="text-success">+5 000</td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <!-- ================= JS Charts ================= -->
    <script>
        // LINE CHART
        const lineCtx = document.getElementById('lineChart').getContext('2d');
        const lineChart = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: {{ chart_labels_json|safe }},
                datasets: [{
                    label: 'Total Transactions',
                    data: {{ chart_data_json|safe }},
                    borderColor: '#0077b6',
                    backgroundColor: 'rgba(0, 119, 182,0.2)',
                    tension: 0.4,
                    fill:true
                }]
            },
            options: { responsive:true, plugins:{legend:{display:true}}, scales:{y:{beginAtZero:true}} }
        });

        // BAR CHART
        const barCtx = document.getElementById('barChart').getContext('2d');
        const barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ["Personnel", "Marketing", "Informatique", "R&D", "Autres"],
                datasets: [{
                    label:"Charges",
                    data:[20000,15000,12000,10000,8000],
                    backgroundColor:'#00a1e0'
                }]
            },
            options:{responsive:true, scales:{y:{beginAtZero:true}}}
        });

        // DONUT CHART
        const donutCtx = document.getElementById('donutChart').getContext('2d');
        const donutChart = new Chart(donutCtx, {
            type: 'doughnut',
            data: {
                labels:["Compte A","Compte B","Compte C","Compte D"],
                datasets:[{
                    data:[30,25,25,20],
                    backgroundColor:['#0077b6','#00a1e0','#f5b700','#1c1f26']
                }]
            },
            options:{responsive:true}
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
